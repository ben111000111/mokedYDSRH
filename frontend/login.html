<!doctype html>
<html lang="he" dir="rtl">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>כניסה | מערכת מוקד מצוקה יד שרה</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-slate-100 flex items-center justify-center p-4">
<div class="w-full max-w-md bg-white rounded-3xl shadow p-6">

  <div class="flex items-center gap-3 mb-4">
    <div id="logo"></div>
    <div class="font-extrabold text-xl">מערכת מוקד</div>
  </div>

  <div id="status" class="text-sm mb-3 text-slate-500">בודק חיבור…</div>

  <div class="flex gap-2 mb-4">
    <button id="tab-login" class="flex-1 bg-slate-900 text-white py-2 rounded-xl font-bold">כניסה</button>
    <button id="tab-reg" class="flex-1 bg-slate-200 py-2 rounded-xl font-bold">רישום</button>
  </div>

  <form id="loginForm" class="space-y-3">
    <input id="login" class="w-full p-3 rounded-xl border" placeholder="טלפון או מייל"/>
    <input id="pass" type="password" class="w-full p-3 rounded-xl border" placeholder="סיסמה"/>
    <button class="w-full bg-blue-600 text-white py-3 rounded-xl font-bold">כניסה</button>
  </form>

  <form id="regForm" class="space-y-3 hidden">
    <input id="name" class="w-full p-3 rounded-xl border" placeholder="שם מלא"/>
    <input id="phone" class="w-full p-3 rounded-xl border" placeholder="טלפון"/>
    <input id="email" class="w-full p-3 rounded-xl border" placeholder="מייל"/>
    <input id="rpass" type="password" class="w-full p-3 rounded-xl border" placeholder="סיסמה"/>
    <button class="w-full bg-emerald-600 text-white py-3 rounded-xl font-bold">רישום</button>
  </form>

  <div id="msg" class="mt-3 font-bold"></div>
</div>

<script type="module">
import { CONFIG } from "./config.js";
import { loadLogo, apiGet, apiPost, setSession } from "./app.js";

loadLogo(document.getElementById("logo"));

apiGet("health").then(r=>{
  document.getElementById("status").textContent = r.ok ? "מחובר ✔" : "שגיאה";
});

const loginForm=document.getElementById("loginForm");
const regForm=document.getElementById("regForm");
document.getElementById("tab-login").onclick=()=>{loginForm.classList.remove("hidden");regForm.classList.add("hidden");};
document.getElementById("tab-reg").onclick=()=>{regForm.classList.remove("hidden");loginForm.classList.add("hidden");};

loginForm.onsubmit=async e=>{
  e.preventDefault();
  const r=await apiPost("login",{login:login.value,password:pass.value});
  if(!r.ok){msg.textContent=r.error;return;}
  setSession(r.token,r.user);
  location.href="schedule.html";
};

regForm.onsubmit=async e=>{
  e.preventDefault();
  const r=await apiPost("register",{name:name.value,phone:phone.value,email:email.value,password:rpass.value});
  msg.textContent=r.ok?"נרשמת – ממתין לאישור":"שגיאה";
};
</script>
</body>
</html>
